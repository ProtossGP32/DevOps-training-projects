<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DevOps Training Projects - Part 1 - Installing Proxmox VE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../homelab-project/virtualization-server/02-virtual-networks.html" rel="next">
<link href="../../homelab-project/virtual-resources-creation/01-virtual-machines.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">DevOps Training Projects</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-devops-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">DevOps exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-devops-exercises">    
        <li class="dropdown-header">Explore California</li>
        <li>
    <a class="dropdown-item" href="../../devops-exercises/explore-california/00-introduction.html">
 <span class="dropdown-text">Explore California - Static website debugging and deployment</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-homelab-project" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Homelab project</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-homelab-project">    
        <li>
    <a class="dropdown-item" href="../../homelab-project/00-introduction.html">
 <span class="dropdown-text">Homelab project introduction</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Requirements</li>
        <li>
    <a class="dropdown-item" href="../../homelab-project/requirements/00-requirements.html">
 <span class="dropdown-text">Homelab Requirements</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Virtual Resources Creation</li>
        <li>
    <a class="dropdown-item" href="../../homelab-project/virtual-resources-creation/02-containers.html">
 <span class="dropdown-text">LXC - Linux Containers on Proxmox</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../homelab-project/virtual-resources-creation/01-virtual-machines.html">
 <span class="dropdown-text">Virtual Machines on Proxmox</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Virtualization Server</li>
        <li>
    <a class="dropdown-item" href="../../homelab-project/virtualization-server/01-installing-proxmox.html">
 <span class="dropdown-text">Part 1 - Installing Proxmox VE</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../homelab-project/virtualization-server/02-virtual-networks.html">
 <span class="dropdown-text">Part 2 - Virtual Networks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../homelab-project/virtualization-server/03-dns-dhcp-servers.html">
 <span class="dropdown-text">Part 3 - DNS and DHCP servers</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/protossgp32"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Part 1 - Installing Proxmox VE</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homelab-project/00-introduction.html" class="sidebar-item-text sidebar-link">Homelab project introduction</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Requirements</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homelab-project/requirements/00-requirements.html" class="sidebar-item-text sidebar-link">Homelab Requirements</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Virtual Resources Creation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homelab-project/virtual-resources-creation/02-containers.html" class="sidebar-item-text sidebar-link">LXC - Linux Containers on Proxmox</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homelab-project/virtual-resources-creation/01-virtual-machines.html" class="sidebar-item-text sidebar-link">Virtual Machines on Proxmox</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Virtualization Server</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homelab-project/virtualization-server/01-installing-proxmox.html" class="sidebar-item-text sidebar-link active">Part 1 - Installing Proxmox VE</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homelab-project/virtualization-server/02-virtual-networks.html" class="sidebar-item-text sidebar-link">Part 2 - Virtual Networks</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../homelab-project/virtualization-server/03-dns-dhcp-servers.html" class="sidebar-item-text sidebar-link">Part 3 - DNS and DHCP servers</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-proxmox-ve" id="toc-what-is-proxmox-ve" class="nav-link active" data-scroll-target="#what-is-proxmox-ve">What is Proxmox VE?</a></li>
  <li><a href="#initial-configuration" id="toc-initial-configuration" class="nav-link" data-scroll-target="#initial-configuration">Initial configuration</a>
  <ul class="collapse">
  <li><a href="#ip-address-assigned-via-dhcp" id="toc-ip-address-assigned-via-dhcp" class="nav-link" data-scroll-target="#ip-address-assigned-via-dhcp">IP address assigned via DHCP</a></li>
  <li><a href="#allow-https-on-port-443-via-nginx" id="toc-allow-https-on-port-443-via-nginx" class="nav-link" data-scroll-target="#allow-https-on-port-443-via-nginx">Allow HTTPS on Port 443 via Nginx</a>
  <ul class="collapse">
  <li><a href="#install-and-configure-nginx" id="toc-install-and-configure-nginx" class="nav-link" data-scroll-target="#install-and-configure-nginx">Install and Configure Nginx</a></li>
  <li><a href="#restart-nginx-and-enable-it-by-default" id="toc-restart-nginx-and-enable-it-by-default" class="nav-link" data-scroll-target="#restart-nginx-and-enable-it-by-default">Restart Nginx and Enable it by Default</a></li>
  <li><a href="#make-proxmox-ui-service-listen-to-localhost-only" id="toc-make-proxmox-ui-service-listen-to-localhost-only" class="nav-link" data-scroll-target="#make-proxmox-ui-service-listen-to-localhost-only">Make Proxmox UI Service Listen to Localhost Only</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/protossgp32/DevOps-training-projects/edit/main/docs/homelab-project/virtualization-server/01-installing-proxmox.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/protossgp32/DevOps-training-projects/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Part 1 - Installing Proxmox VE</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="what-is-proxmox-ve" class="level1">
<h1>What is Proxmox VE?</h1>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
TODO
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pending to describe Proxmox</p>
</div>
</div>
</section>
<section id="initial-configuration" class="level1">
<h1>Initial configuration</h1>
<section id="ip-address-assigned-via-dhcp" class="level2">
<h2 class="anchored" data-anchor-id="ip-address-assigned-via-dhcp">IP address assigned via DHCP</h2>
<p>This way the DHCP server will assign the correct domain name and the server will be accessible by its domain name.</p>
<p>A server should always have a predictable IP, so configure the DHCP server to lease the same IP to the Proxmox server network MAC address.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
TODO
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pending to elaborate</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Regarding DNS and DHCP servers…
</div>
</div>
<div class="callout-body-container callout-body">
<p>Later on, we’ll configure our own virtual DHCP and DNS servers to provide internal IPs to our VM and containers.</p>
</div>
</div>
</section>
<section id="allow-https-on-port-443-via-nginx" class="level2">
<h2 class="anchored" data-anchor-id="allow-https-on-port-443-via-nginx">Allow HTTPS on Port 443 via Nginx</h2>
<p>As Lars mentions in his guide, the web interface of Proxmox is available on port <code>8006</code> instead of the default HTTPS port <code>443</code>, and HTTP on Port <code>80</code> is not available at all.</p>
<p>Having HTTPS acesses through ports different than <code>443</code> can be very bothersome as we need to remember what exact port is the one used on each service.</p>
<p>In order to solve this, we’ll use a light-weight web server that also acts as a reverse proxy natively in the Proxmox server, so we can redirect <code>443</code> requests to the <code>8006</code> port.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
About Nginx…
</div>
</div>
<div class="callout-body-container callout-body">
<p>Later on we’ll be also deploying other Nginx servers within our internal networks to redirect traffic to each one of our services</p>
</div>
</div>
<section id="install-and-configure-nginx" class="level3">
<h3 class="anchored" data-anchor-id="install-and-configure-nginx">Install and Configure Nginx</h3>
<p>Connect via <code>SSH</code> to the PVE server as <code>root</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">ssh</span> root@<span class="op">&lt;</span>proxmox-ip<span class="op">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># or</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">ssh</span> root@<span class="op">&lt;</span>proxmox-hostname<span class="op">&gt;</span>.<span class="op">&lt;</span>local-domain<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Install the <code>nginx-light</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">apt-get</span> install nginx-light</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A web server should already be up and running. Verify it by accessing <code>http://&lt;proxmox-ip&gt;/</code> or <code>http://&lt;proxmox-hostname&gt;.&lt;local-domain&gt;</code>, a blank welcome screen should appear.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/homelab-project/virtualization/proxmox-nginx-welcome-web-page.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Nginx welcome web page</figcaption><p></p>
</figure>
</div>
<p>Once done, remove the default Nginx configuration from the Proxmox server…</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">rm</span> /etc/nginx/sites-<span class="pp">*</span>/default</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>…and create a new file <code>/etc/nginx/sites-available/proxmox-web-interface</code> with the following content:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>/etc/nginx/sites-available/proxmox-web-interface</strong></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource py number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>server {</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="co"># Enforce HTTPS by redirecting requests</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  listen <span class="dv">80</span><span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  listen [::]:<span class="dv">80</span><span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  server_name pve.protossnet.local<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a>  location <span class="op">/</span> {</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="cf">return</span> <span class="dv">301</span> https:<span class="op">//</span>pve.protossnet.local$request_uri<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  }</span>
<span id="cb4-10"><a href="#cb4-10"></a>}</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a>server {</span>
<span id="cb4-13"><a href="#cb4-13"></a>  listen <span class="dv">443</span> ssl http2<span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>  listen [::]:<span class="dv">443</span> ssl http2<span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>  server_name pve.protossnet.local<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16"></a></span>
<span id="cb4-17"><a href="#cb4-17"></a>  ssl_certificate_key <span class="op">/</span>etc<span class="op">/</span>pve<span class="op">/</span>local<span class="op">/</span>pve<span class="op">-</span>ssl.key<span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>  ssl_certificate     <span class="op">/</span>etc<span class="op">/</span>pve<span class="op">/</span>local<span class="op">/</span>pve<span class="op">-</span>ssl.pem<span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19"></a></span>
<span id="cb4-20"><a href="#cb4-20"></a>  <span class="co"># Proxy configuration</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>  location <span class="op">/</span> {</span>
<span id="cb4-22"><a href="#cb4-22"></a>    proxy_http_version <span class="fl">1.1</span><span class="op">;</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>    proxy_set_header Upgrade $http_upgrade<span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>    proxy_set_header Connection <span class="st">"upgrade"</span><span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>    proxy_pass https:<span class="op">//</span><span class="fl">127.0.0.1</span>:<span class="dv">8006</span><span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>    proxy_buffering off<span class="op">;</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>    client_max_body_size <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28"></a>    proxy_connect_timeout  <span class="dv">3600</span><span class="er">s</span><span class="op">;</span></span>
<span id="cb4-29"><a href="#cb4-29"></a>    proxy_read_timeout  <span class="dv">3600</span><span class="er">s</span><span class="op">;</span></span>
<span id="cb4-30"><a href="#cb4-30"></a>    proxy_send_timeout  <span class="dv">3600</span><span class="er">s</span><span class="op">;</span></span>
<span id="cb4-31"><a href="#cb4-31"></a>    send_timeout  <span class="dv">3600</span><span class="er">s</span><span class="op">;</span></span>
<span id="cb4-32"><a href="#cb4-32"></a>    proxy_set_header Host $host<span class="op">;</span></span>
<span id="cb4-33"><a href="#cb4-33"></a>    proxy_ssl_name $host<span class="op">;</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>    proxy_set_header X<span class="op">-</span>Forwarded<span class="op">-</span>For $remote_addr<span class="op">;</span></span>
<span id="cb4-35"><a href="#cb4-35"></a>  }</span>
<span id="cb4-36"><a href="#cb4-36"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Lars has additional and more complex Nginx configs for the web interface, it’s worth checking them out to learn about how Nginx works and how powerful it can be!</p>
</div>
</div>
<p>After updating the configuration, we must create a softlink from the <code>sites-enabled</code> directory to make it available:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="bu">cd</span> /etc/nginx/sites-enabled</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">ln</span> <span class="at">-s</span> /etc/nginx/sites-available/proxmox-web-interface</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, we check if Nginx can spot any errors:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="ex">nginx</span> <span class="at">-t</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="restart-nginx-and-enable-it-by-default" class="level3">
<h3 class="anchored" data-anchor-id="restart-nginx-and-enable-it-by-default">Restart Nginx and Enable it by Default</h3>
<p>To start Nginx and make sure it starts automatically after a system reboot, run:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Restart the Nginx service</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="ex">systemctl</span> restart nginx.service</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># Permanently enable the Nginx service</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="ex">systemctl</span> enable nginx.service</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, make sure that Nginx will start only after Proxmox starts, since the certificates may otherwise not be available yet. To do that, create a file <code>/etc/systemd/system/nginx.service.d/override.conf</code> with the content:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a><span class="ex">[Unit]</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="va">Requires</span><span class="op">=</span>pve-cluster.service</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="va">After</span><span class="op">=</span>pve-cluster.service</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Alternatively, you can also use <code>systemctl edit nginx.service</code> to edit this file.</p>
<p>With the service restarted, check that we can access the Proxmox VE web interface through the expected HTTPS port by going to <code>https://&lt;proxmox-hostname&gt;.&lt;local-domain&gt;</code> or <code>https://&lt;proxmox-ip&gt;</code>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/homelab-project/virtualization/proxmox-nginx-correct-redirection.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Proxmox - Nginx correctly redirecting HTTPS request</figcaption><p></p>
</figure>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
What about the insecure HTTPS warning?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Right now Nginx is using the SSL certificates provided by Proxmox on installation time. We should provide valid SSL certifications to avoid this, such as the ones that Let’s Encript can generate.</p>
</div>
</div>
</section>
<section id="make-proxmox-ui-service-listen-to-localhost-only" class="level3">
<h3 class="anchored" data-anchor-id="make-proxmox-ui-service-listen-to-localhost-only">Make Proxmox UI Service Listen to Localhost Only</h3>
<div class="callout-warning callout callout-style-simple">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Lars suggests this change to ensure that <em>everyone is using the Nginx set-up</em>, but I don’t really understand what exactly means. I’ve applied the change and at least I can still access it from within my local network.</p>
</div>
</div>
</div>
<p>Create <code>/etc/default/pveproxy</code> and set:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="va">LISTEN_IP</span><span class="op">=</span><span class="st">"127.0.0.1"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then restart the <code>pveproxy</code> service:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a><span class="ex">systemctl</span> restart pveproxy.service</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../homelab-project/virtual-resources-creation/01-virtual-machines.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Virtual Machines on Proxmox</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../homelab-project/virtualization-server/02-virtual-networks.html" class="pagination-link">
        <span class="nav-page-text">Part 2 - Virtual Networks</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>